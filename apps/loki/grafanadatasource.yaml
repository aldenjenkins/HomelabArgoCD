apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDatasource
metadata:
  name: loki-datasource
spec:
  allowCrossNamespaceImport: true
  datasource:
    name: loki
    uid: loki
    type: loki
    access: proxy
    url: http://loki.loki.svc.cluster.local:3100
    jsonData:
      timeout: 60
      maxLines: 1000
      derivedFields:
        # Field with internal link pointing to data source in Grafana.
        # datasourceUid value can be anything, but it should be unique across all defined data source uids.
        - datasourceUid: tempo
          datasourceName: Tempo
          matcherRegex: "trace_id"
          name: traceID
          matcherType: label
          # url will be interpreted as query for the datasource
          url: '${__value.raw}'
          # optional for URL Label to set a custom display label for the link.
          urlDisplayLabel: 'View Trace'
        - datasourceUid: tempo
          datasourceName: Tempo
          matcherRegex: "span_id"
          name: spanID
          matcherType: label
          # url will be interpreted as query for the datasource
          url: '${__value.raw}'
          # optional for URL Label to set a custom display label for the link.
          urlDisplayLabel: 'View Span'
  instanceSelector:
    matchLabels:
      dashboards: grafana
