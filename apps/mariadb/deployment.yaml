apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql-exporter
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mysql-exporter
  template:
    metadata:
      labels:
        app: mysql-exporter
    spec:
      containers:
        - name: mysql-exporter
          image: prom/mysqld-exporter:latest
          args:
            - --collect.auto_increment.columns
            - --collect.binlog_size
            - --collect.engine_innodb_status
            - --collect.global_status
            - --collect.global_variables
            - --collect.info_schema.clientstats
            - --collect.info_schema.innodb_tablespaces
            - --collect.info_schema.innodb_cmp
            - --collect.info_schema.innodb_cmpmem
            - --collect.info_schema.innodb_metrics
            - --collect.info_schema.processlist
            - --collect.info_schema.query_response_time
            - --collect.info_schema.replica_host
            - --collect.info_schema.tables
            - --collect.info_schema.tablestats
            - --collect.info_schema.schemastats
            - --collect.info_schema.userstats
            - --collect.mysql.user
            - --collect.perf_schema.eventswaits
            - --collect.perf_schema.file_events
            - --collect.perf_schema.indexiowaits
            - --collect.perf_schema.tableiowaits
            - --collect.perf_schema.tablelocks
            - --collect.perf_schema.eventsstatements
            - --no-collect.slave_status
          ports:
            - containerPort: 9104
              name: metrics
          volumeMounts:
            - name: mysql-exporter-config
              mountPath: /.my.cnf
              subPath: .my.cnf
              readOnly: true
      volumes:
        - name: mysql-exporter-config
          secret:
            secretName: mysql-exporter-secret
