apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: x509-certificate-exporter-cp
  labels:
    app.kubernetes.io/name: x509-certificate-exporter
    app.kubernetes.io/instance: x509-certificate-exporter
    app.kubernetes.io/version: "3.19.1"
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: x509-certificate-exporter
      app.kubernetes.io/instance: x509-certificate-exporter
  template:
    metadata:
      labels:
        app.kubernetes.io/name: x509-certificate-exporter
        app.kubernetes.io/instance: x509-certificate-exporter
        app.kubernetes.io/version: "3.19.1"
    spec:
      serviceAccountName: x509-certificate-exporter-node
      tolerations:
      - effect: NoSchedule
        key: node-role.kubernetes.io/control-plane
        operator: Exists
      nodeSelector:
        node-role.kubernetes.io/control-plane: ""
      restartPolicy: Always
      containers:
      - name: x509-certificate-exporter
        securityContext:
          capabilities:
            add:
            - SYS_ADMIN
            drop:
            - ALL
          privileged: true
          readOnlyRootFilesystem: true
          runAsGroup: 0
          runAsUser: 0
        resources:
          limits:
            cpu: 1
            memory: 40Mi
          requests:
            cpu: 10m
            memory: 20Mi
        image: docker.io/enix/x509-certificate-exporter:3.19.1
        imagePullPolicy: IfNotPresent
        args:
        - --listen-address=:9793
        - --trim-path-components=3
        - --watch-file=/mnt/watch/file-15d8ed7db7457d4f5108195ceb52a124a8703898//etc/kubernetes/pki/ca.crt
        - --watch-file=/mnt/watch/file-9dff78b77fe2f4b0f34f77796df3fea5983e5d4b//var/lib/kubelet/pki/kubelet-client-current.pem
        - --watch-file=/mnt/watch/file-ef23ff818657e3d67153bdcf9fea44bc7b26dd46//system/secrets/etcd/server.crt
        - --watch-file=/mnt/watch/file-8db5458d5e64ad1401c3711368dba4c4c8ac8bc3//system/secrets/etcd/peer.crt
        - --watch-file=/mnt/watch/file-6d45ed2688c5b3ad3cc5be45a91d26cb271a4218//system/secrets/etcd/ca.crt
        - --watch-file=/mnt/watch/file-92321db8350ddc5464be1724be35017361f3c39b//system/secrets/etcd/admin.crt
        - --watch-file=/mnt/watch/file-f6e30ef4890e21bdf7ff669616ae1b17114e573f//system/secrets/kubernetes/kube-apiserver/aggregator-ca.crt
        - --watch-file=/mnt/watch/file-3209a98956f97b4b40365fe941e3748b8d196352//system/secrets/kubernetes/kube-apiserver/apiserver-kubelet-client.crt
        - --watch-file=/mnt/watch/file-94fd064fc1f26197d80bde8520f274ca908dc77d//system/secrets/kubernetes/kube-apiserver/apiserver.crt
        - --watch-file=/mnt/watch/file-e38e7736bd7b8cea692b21f93092cffac5ef3173//system/secrets/kubernetes/kube-apiserver/ca.crt
        - --watch-file=/mnt/watch/file-a03e6bdde4286e9c6ed775d8d83f32d32c189944//system/secrets/kubernetes/kube-apiserver/etcd-client-ca.crt
        - --watch-file=/mnt/watch/file-9fb8b490fe79e9b9ac7e26b0cfe2f9a5d0e40b38//system/secrets/kubernetes/kube-apiserver/etcd-client.crt
        - --watch-file=/mnt/watch/file-abcdeb572ae0a45ef7207413c494cc5a5ee325ac//system/secrets/kubernetes/kube-apiserver/front-proxy-client.crt
        - --max-cache-duration=300s
        volumeMounts:
        - name: file-15d8ed7db7457d4f5108195ceb52a124a8703898
          mountPath: /mnt/watch/file-15d8ed7db7457d4f5108195ceb52a124a8703898//etc/kubernetes/pki
          readOnly: true
        - name: file-9dff78b77fe2f4b0f34f77796df3fea5983e5d4b
          mountPath: /mnt/watch/file-9dff78b77fe2f4b0f34f77796df3fea5983e5d4b//var/lib/kubelet/pki
          readOnly: true
        - name: file-ef23ff818657e3d67153bdcf9fea44bc7b26dd46
          mountPath: /mnt/watch/file-ef23ff818657e3d67153bdcf9fea44bc7b26dd46//system/secrets/etcd
          readOnly: true
        - name: file-8db5458d5e64ad1401c3711368dba4c4c8ac8bc3
          mountPath: /mnt/watch/file-8db5458d5e64ad1401c3711368dba4c4c8ac8bc3//system/secrets/etcd
          readOnly: true
        - name: file-6d45ed2688c5b3ad3cc5be45a91d26cb271a4218
          mountPath: /mnt/watch/file-6d45ed2688c5b3ad3cc5be45a91d26cb271a4218//system/secrets/etcd
          readOnly: true
        - name: file-92321db8350ddc5464be1724be35017361f3c39b
          mountPath: /mnt/watch/file-92321db8350ddc5464be1724be35017361f3c39b//system/secrets/etcd
          readOnly: true
        - name: file-f6e30ef4890e21bdf7ff669616ae1b17114e573f
          mountPath: /mnt/watch/file-f6e30ef4890e21bdf7ff669616ae1b17114e573f//system/secrets/kubernetes/kube-apiserver
          readOnly: true
        - name: file-3209a98956f97b4b40365fe941e3748b8d196352
          mountPath: /mnt/watch/file-3209a98956f97b4b40365fe941e3748b8d196352//system/secrets/kubernetes/kube-apiserver
          readOnly: true
        - name: file-94fd064fc1f26197d80bde8520f274ca908dc77d
          mountPath: /mnt/watch/file-94fd064fc1f26197d80bde8520f274ca908dc77d//system/secrets/kubernetes/kube-apiserver
          readOnly: true
        - name: file-e38e7736bd7b8cea692b21f93092cffac5ef3173
          mountPath: /mnt/watch/file-e38e7736bd7b8cea692b21f93092cffac5ef3173//system/secrets/kubernetes/kube-apiserver
          readOnly: true
        - name: file-a03e6bdde4286e9c6ed775d8d83f32d32c189944
          mountPath: /mnt/watch/file-a03e6bdde4286e9c6ed775d8d83f32d32c189944//system/secrets/kubernetes/kube-apiserver
          readOnly: true
        - name: file-9fb8b490fe79e9b9ac7e26b0cfe2f9a5d0e40b38
          mountPath: /mnt/watch/file-9fb8b490fe79e9b9ac7e26b0cfe2f9a5d0e40b38//system/secrets/kubernetes/kube-apiserver
          readOnly: true
        - name: file-abcdeb572ae0a45ef7207413c494cc5a5ee325ac
          mountPath: /mnt/watch/file-abcdeb572ae0a45ef7207413c494cc5a5ee325ac//system/secrets/kubernetes/kube-apiserver
          readOnly: true
        ports:
        - name: metrics
          containerPort: 9793
        readinessProbe:
          initialDelaySeconds: 5
          periodSeconds: 3
          httpGet:
            path: /healthz
            port: metrics
        livenessProbe:
          initialDelaySeconds: 5
          periodSeconds: 3
          httpGet:
            path: /healthz
            port: metrics
      hostNetwork: false
      volumes:
      - name: file-15d8ed7db7457d4f5108195ceb52a124a8703898
        hostPath:
          path: /etc/kubernetes/pki
      - name: file-9dff78b77fe2f4b0f34f77796df3fea5983e5d4b
        hostPath:
          path: /var/lib/kubelet/pki
      - name: file-ef23ff818657e3d67153bdcf9fea44bc7b26dd46
        hostPath:
          path: /system/secrets/etcd
      - name: file-8db5458d5e64ad1401c3711368dba4c4c8ac8bc3
        hostPath:
          path: /system/secrets/etcd
      - name: file-6d45ed2688c5b3ad3cc5be45a91d26cb271a4218
        hostPath:
          path: /system/secrets/etcd
      - name: file-92321db8350ddc5464be1724be35017361f3c39b
        hostPath:
          path: /system/secrets/etcd
      - name: file-f6e30ef4890e21bdf7ff669616ae1b17114e573f
        hostPath:
          path: /system/secrets/kubernetes/kube-apiserver
      - name: file-3209a98956f97b4b40365fe941e3748b8d196352
        hostPath:
          path: /system/secrets/kubernetes/kube-apiserver
      - name: file-94fd064fc1f26197d80bde8520f274ca908dc77d
        hostPath:
          path: /system/secrets/kubernetes/kube-apiserver
      - name: file-e38e7736bd7b8cea692b21f93092cffac5ef3173
        hostPath:
          path: /system/secrets/kubernetes/kube-apiserver
      - name: file-a03e6bdde4286e9c6ed775d8d83f32d32c189944
        hostPath:
          path: /system/secrets/kubernetes/kube-apiserver
      - name: file-9fb8b490fe79e9b9ac7e26b0cfe2f9a5d0e40b38
        hostPath:
          path: /system/secrets/kubernetes/kube-apiserver
      - name: file-abcdeb572ae0a45ef7207413c494cc5a5ee325ac
        hostPath:
          path: /system/secrets/kubernetes/kube-apiserver
---
# Source: x509-certificate-exporter/templates/daemonset.yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: x509-certificate-exporter-nodes
  labels:
    app.kubernetes.io/name: x509-certificate-exporter
    app.kubernetes.io/instance: x509-certificate-exporter
    app.kubernetes.io/version: "3.19.1"
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: x509-certificate-exporter
      app.kubernetes.io/instance: x509-certificate-exporter
  template:
    metadata:
      labels:
        app.kubernetes.io/name: x509-certificate-exporter
        app.kubernetes.io/instance: x509-certificate-exporter
        app.kubernetes.io/version: "3.19.1"
    spec:
      serviceAccountName: x509-certificate-exporter-node
      restartPolicy: Always
      containers:
      - name: x509-certificate-exporter
        securityContext:
          capabilities:
            add:
            - SYS_ADMIN
            drop:
            - ALL
          privileged: true
          readOnlyRootFilesystem: true
          runAsGroup: 0
          runAsUser: 0
        resources:
          limits:
            cpu: 1
            memory: 40Mi
          requests:
            cpu: 10m
            memory: 20Mi
        image: docker.io/enix/x509-certificate-exporter:3.19.1
        imagePullPolicy: IfNotPresent
        args:
        - --listen-address=:9793
        - --trim-path-components=3
        - --watch-file=/mnt/watch/file-15d8ed7db7457d4f5108195ceb52a124a8703898//etc/kubernetes/pki/ca.crt
        - --watch-file=/mnt/watch/file-9dff78b77fe2f4b0f34f77796df3fea5983e5d4b//var/lib/kubelet/pki/kubelet-client-current.pem
        - --max-cache-duration=300s
        volumeMounts:
        - name: file-15d8ed7db7457d4f5108195ceb52a124a8703898
          mountPath: /mnt/watch/file-15d8ed7db7457d4f5108195ceb52a124a8703898//etc/kubernetes/pki
          readOnly: true
        - name: file-9dff78b77fe2f4b0f34f77796df3fea5983e5d4b
          mountPath: /mnt/watch/file-9dff78b77fe2f4b0f34f77796df3fea5983e5d4b//var/lib/kubelet/pki
          readOnly: true
        ports:
        - name: metrics
          containerPort: 9793
        readinessProbe:
          initialDelaySeconds: 5
          periodSeconds: 3
          httpGet:
            path: /healthz
            port: metrics
        livenessProbe:
          initialDelaySeconds: 5
          periodSeconds: 3
          httpGet:
            path: /healthz
            port: metrics
      hostNetwork: false
      volumes:
      - name: file-15d8ed7db7457d4f5108195ceb52a124a8703898
        hostPath:
          path: /etc/kubernetes/pki
      - name: file-9dff78b77fe2f4b0f34f77796df3fea5983e5d4b
        hostPath:
          path: /var/lib/kubelet/pki
