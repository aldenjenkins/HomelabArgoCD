apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDatasource
metadata:
  name: miniflux-postgres
spec:
  allowCrossNamespaceImport: true
  instanceSelector:
    matchLabels:
      dashboards: "grafana"
  datasource:
    name: miniflux-postgres
    type: postgres
    isDefault: false
    url: miniflux-postgres-18-ro.miniflux.svc:5432
    user: $username
    access: proxy
    jsonData:
      database: miniflux
      postgresVersion: 1800
      sslmode: disable
      timescaledb: false
    secureJsonData:
      password: $password
  valuesFrom:
    - targetPath: secureJsonData.password
      valueFrom:
        secretKeyRef:
          name: miniflux-postgres-18-app
          key: password
    - targetPath: user
      valueFrom:
        secretKeyRef:
          name: miniflux-postgres-18-app
          key: username
