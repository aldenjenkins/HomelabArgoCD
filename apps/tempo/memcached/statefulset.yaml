apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: tempo-memcached
  labels:
    helm.sh/chart: tempo-distributed-1.52.9
    app.kubernetes.io/name: tempo
    app.kubernetes.io/instance: tempo
    app.kubernetes.io/component: memcached
    app.kubernetes.io/version: "2.9.0"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/name: tempo
      app.kubernetes.io/instance: tempo
      app.kubernetes.io/component: memcached
  serviceName: memcached
  template:
    metadata:
      annotations:
        prometheus.io/path: /metrics
        prometheus.io/port: "3200"
        prometheus.io/scrape: "true"
      labels:
        helm.sh/chart: tempo-distributed-1.52.9
        app.kubernetes.io/name: tempo
        app.kubernetes.io/instance: tempo
        app.kubernetes.io/component: memcached
        app.kubernetes.io/version: "2.9.0"
        app.kubernetes.io/managed-by: Helm
        app.homelab/environment: prod
        app.homelab/huid: huid-ovz6vtlh
        app.homelab/owner: homelab.techservices.data.observability
        app.homelab/service: Tempo
    spec:
      serviceAccountName: tempo
      securityContext:
        fsGroup: 1000
      enableServiceLinks: false
      
      initContainers:
        []
      containers:
        - image: docker.io/memcached:1.6.40-alpine
          imagePullPolicy: IfNotPresent
          name: memcached
          args:
            - -m 131072
            - -c 4096
            - -t 8
          ports:
            - containerPort: 11211
              name: client
          readinessProbe:
            failureThreshold: 6
            initialDelaySeconds: 5
            periodSeconds: 5
            successThreshold: 1
            tcpSocket:
              port: client
            timeoutSeconds: 3
          livenessProbe:
            exec:
              command:
                - pgrep
                - memcached
            failureThreshold: 6
            initialDelaySeconds: 30
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 5
          resources:
            limits:
              memory: 5Gi
            requests:
              cpu: 1
              memory: 3Gi
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
              - ALL
            readOnlyRootFilesystem: true
            runAsGroup: 1000
            runAsNonRoot: true
            runAsUser: 1000
  updateStrategy:
    type: RollingUpdate
